<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harrie Jonkman">
<meta name="dcterms.date" content="2025-09-29">
<meta name="description" content="In het nieuwe boek van Daniel Yon (A Trick of the Mind. How the Brain Invents Your Reality*) laat hij zien hoe onze hersenen werken en hoe we die moeten begrijpen. De hersenen ziet Yon als een wetenschapper die daar in ons hoofd zit opgesloten. Deze hersenen zetten datgene wat hij in de werkelijkheid tegenkomt af tegen dat wat hij ervan verwacht. Zo gaan ze als een wetenschapper te werk in de wereld van de materie, in de mentale wereld en de wereld van ideeën. Een Bayesiaanse wetenschapper wel te verstaan, die naar de balans tussen beide elementen zoekt.">

<title>De wetenschapper in jouw hoofd – DemOndBlog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DemOndBlog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Over dit blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">De wetenschapper in jouw hoofd</h1>
                  <div>
        <div class="description">
          <em>In het nieuwe boek van Daniel Yon (</em>A Trick of the Mind. How the Brain Invents Your Reality*) laat hij zien hoe onze hersenen werken en hoe we die moeten begrijpen. De hersenen ziet Yon als een wetenschapper die daar in ons hoofd zit opgesloten. Deze hersenen zetten datgene wat hij in de werkelijkheid tegenkomt af tegen dat wat hij ervan verwacht. Zo gaan ze als een wetenschapper te werk in de wereld van de materie, in de mentale wereld en de wereld van ideeën. Een Bayesiaanse wetenschapper wel te verstaan, die naar de balans tussen beide elementen zoekt.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Democratie</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Harrie Jonkman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 29, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><em>Als je de wetenschapper in je hoofd ontmoet, ga je denken als een wetenschapper. .</em><br>
- Daniel Yon</p>
<p><br></p>
<p>De relatie met onze hersenen is een ingewikkelde, zo schrijftDaniel Yon ergens aan het begin van zijn onlangs verschenen boek <em>A Trick of the Mind. How the Brain Invents Your Reality</em>. Onze geest lijkt een dubbelleven te leiden. Aan de ene kant zijn we trots op dat leven omdat ze wonderen heeft verricht. Ze heeft penicilline ontdekt, democratie en wetgeving ontwikkeld, literatuur en kunst gemaakt en ons zelfs op de maan gezet. Maar diezelfde geest is ook oh zo fragiel. We kunnen ons schamen voor haar als we denken aan ons bijgeloof, vooroordeel en onze vooringenomenheid. Rood op de wangen krijgen we ook als we denken aan de vreemde politieke bewegingen die we bedenken, de samenzweringstheorieën en al die gevoelens, gedachten en ervaringen die de donkere kanten van de geest laten zien. Als we de hersenpan zouden optillen kunnen we die twee kanten niet onderscheiden. Maar hoe kunnen we wel krijgen op die complexiteit en het geheel ervan goed beschrijven? In de filosofie wordt daar al heel lang over nagedacht en ze heeft er allerlei theorieën over ontwikkeld, de psychologie ontstond later om op dit vraagstuk meer grip te krijgen en de neurowetenschap wilde daar nog een schepje bovenop doen. Daniel Yon is zo’n neurowetenschapper en hij probeert in dit inzichtelijke boek te laten zien hoe die hersenen werken en we er tegenwoordig er het beste naar kunnen kijken. Voor Yon zijn de hersenen net zoiets als een wetenschapper, waar je je mening over kunt hebben en die uiteindelijk niets anders doet dan met theorieën werken. Net als die wetenschapper voeren hersenen experimenten uit, doen ze metingen en formuleren ze theorieën waarmee de bewijsvoering betekenis krijgt. De hersenen filteren als het ware onze wereld zodat we die begrijpen en ermee om kunnen gaan, zonder dat we die overigens ooit perfect kunnen maken. In het velengde van Popper heeft Yon het over drie werelden waarin we leven en waarmee we met die hersenen als wetenschapper hebben om te gaan. Hij heeft het over de wereld van de materie, de mentale wereld en de wereld van ideeën. Omgaan met de werkelijkheid betekent met deze drie werelden tegelijk omgaan.</p>
<p><br></p>
<p>Met onze hersenen en lichaam kunnen we op allerlei manieren materie uit de fysieke wereld (met z’n objecten, atomen en moleculen) meten. Ondanks dat die hersenen in het hoofd zijn opgeslagen, kunnen ze iets met wat daarbuiten allemaal gebeurt. Mensen beschikken over allerlei gereedschappen en instrumenten om signalen om te zetten en die te interpreteren. Tegelijk hebben we theorieën waarmee we die metingen betekenis kunnen geven. Soms hebben we slechts de schaduw van het gezicht van een vriend nodig om vast te stellen om wie het gaat. Halve informatie wordt aangevuld met kennis en informatie waarover we al beschikken en dat wordt tot een geheel gemaakt. Zo kan onze geest z’n eigen theorie vormen over hoe hij denkt dat de wereld in elkaar zit. Elk deel van data waarmee we worden geconfronteerd, wordt geëvalueerd tegen de achtergrond van de kennis waarover we beschikken. Perceptie is volgens Yon eigenlijk niets anders dan het theoriegeladen proces van de wetenschapper en dat komen we tegen bij het zien, het horen en ook in het doen. De wereld van materie benaderen we steeds vanuit wat we verwachten en het resultaat is als het ware de balans tussen de informatie die binnenkomt en de theorie of hypothese die we reeds hebben. Oftewel, het resultaat van de perceptie is steeds de balans tussen de werkelijkheid en de verwachting. Zo gaan we ook vanuit onze hersenene als een wetenschapper met die wereld om; we experimenteren en proberen dingen uit, we zoeken uit hoe het zit met oorzaak en gevolg en over welk deel van de werkelijkheid we controle hebben en over welk deel niet. De tweede wereld is de mentale wereld met z’n gedachten, gevoelens, hoop, wensen en angsten. Hier gaat het om vragen als hoe we kunnen weten hoe iemand anders denkt en hoe ons eigen denken eruit ziet. Ook hier hebben we te maken een beperkt beeld en grote onzekerheid en is het steeds nodig te theoretiseren over hoe het nu precies zit. We beginnen met een beperkt beeld, bereiden dat uit en stellen het bij door om te gaan met anderen en te ontdekken wie we zelf zijn. Het blijkt dat mensen moeite hebben met mensen die zich lichamelijk en gedragsmatig anders gedragen dan zijzelf gewend zijn en die anderen hebben dan weer moeite met hen. In dat soort gevallen is tijd nodig om met die werkelijk anderen om te gaan, om onze ervaringen uit te breiden en zo onze theorieën bij te stellen. Door leren en ervaren stellen we ons neuraal vocabulair als het ware bij. In deze mentale wereld is het dus ook zo dat we onze verwachtingen van de ander baseren op hoe onze eigen geest (of beter onze eigen theorie) is opgebouwd. We verwachten een beetje dat de ander als onszelf in elkaar zit en met de contouren van onze eigen geest voorspellen hoe de ander in elkaar zit. Om anderen te begrijpen is het nodig dat we niet meer zo egocentrisch zijn en minder aan onszelf denken om de verschillende mogelijke geesten om ons heen te kunnen zien. Onze hersenen hebben we niet alleen nodig om andere geesten te kunnen lezen, maar ook om onszelf te begrijpen. Dat is vaak veel ingewikkelder dan we denken. Onze geest beschikt over een soort metacognitieve criticus die oog houdt op onze eigen geest en onszelf kan zien. Die criticus heeft trouwens lang niet altijd gelijk omdat ook hier de werkelijkheid en de verwachting uit elkaar kunnen lopen. Soms zijn we goed in iets en denken dat we al te makkelijk ook goed te zijn in iets heel anders. Een andere keer hebben we heel weinig zelfvertrouwen en onderschatten ons model en wat we werkelijk kunnen. De derde wereld is die van ideeën. Hier gaat het over elk object, teken of systeem waarin deze ideëen zijn opgeslagen en dan kun je aan culturele producten denken als filosofie, religie, wetenschap, kunst en boeken. Hier gaat het over hoe de geest de ideeën construeert, ze opbouwt, hoe ze veranderen en hoe we daarmee de werkelijkheid begrijpen. Net als bij de wetenschapper is voor onze geest nieuwsgierigheid van essentieel belang. Ook in de wereld van ideeën wordt de werkelijkheid steeds met de verwachting vergeleken. Iets nieuws kan daarbij een bepaalde bevrediging oproepen, zoals iets nieuws leren daarvoor kan zorgen. Al die verschillende culturele producten die het bestaan betekenis geven kunnen verwondering oproepen en zorgen voor wat Yon wonderlust noemt, het plezier om te zien hoe alles met elkaar samenhangt. Zoals dat ook voor de wetenschapper telt die steeds weer op zoek is naar iets nieuws en naar een nieuwe theorie over hoe het allemaal werkt. Dat lijkt moeilijker te worden in een wereld waarin er allemaal kunstmatige netwerkmodellen komen waar die culturele producten in opgeslagen zijn, waarin het de vraag wordt hoe we oplettend kunnen blijven en hoe we kunnen blijven zien waar de werkelijkheid afwijkt van wat het model in ons hoofd erover zegt.</p>
<p><br></p>
<p>De afgelopen tien jaar heb ik me in mjn werk regelmatig beziggehouden met de Bayesiaanse statistiek. Dat is een methode van onderzoek die anders dan de traditionele statistiek kennis die er reeds bestaat gebruikt om iets over de werkelijkheid te zeggen. Wat we al weten (verwachtingen die hier prior genoemd worden) en wat we recent te weten zijn gekomen (werkelijkheid, de data zeg maar) worden gecombineerd tot een bijgestelde theorie (posterior noemen ze het daar). Het is een aantrekkelijke methode die allerlei voordelen heeft en in dit verband vooral interessant is omdat het naar de balans zoekt tussen verwachting en werkelijkheid. Het is mooi hierover in een niet statistisch boek te lezen en te zien hoe Yon hier gebruik van maakt om nieuwe neurowetenschappelijke inzichten te presenteren. Zijn hele boek door laat hij zien dat we met onze geest de hele dag door niets anders doen dan de wereld betekenis te geven en onze werkelijkheid inschatten, veronderstellen, voorspellen en daarin handelen. Als een wetenschapper in het hoofd doen we dat met onze hersenen in onze fysieke, sociale en culturele werelden tegelijk. Yon legt ons heel goed, overtuigend en consistent uit hoe het allemaal werkt en hoe we het moeten begrijpen. In de conclusie vat hij zijn bevindingen kort samen, maar gaat daar niet in op de vraag wat dit zou kunnen betekenen en wat we op basis van deze inzichten anders zouden kunnen doen. Bijvoorbeeld, dat voorgeven van een democratie gegevens en data over de werkelijkheid op zichheel belangrijk zijn, maar allicht niet genoeg wanneer geen rekening wordt gehouden met de verwachtingen van mensen. De praktische consequenties hadden aandacht verdiend in dit boek. Het boek roept natuurlijk ook vragen op, zoals elk goed boek.Iets dat ik mij tijdens het lezen afvroeg is of alles alleen maar op de weegschap van de realiteit en de verwachtingen gelegd moet worden. Wat is de rol van idealen bijvoorbeeld? Maken die idealen deel uit van de verwachtingen of moet hen eigen kracht worden toegewezen? Dat zou ik graag aan Yon vragen. Maar over het geheel is Yons boek een mooi eigentijds perspectief op de relatie tussen empirie en rationaliteit, een krachtig perpectief dat in je hoofd blijft hangen als je het uitgelezen hebt.</p>
<p><br></p>
<p>Yon, D. (2025). <em>A Trick of the Mind. How the Brain Invents Your Reality</em>. London: Cornerstone Press/Penguin Random House. 288 pagina’s.</p>
<p><img src="Screenshot.png" class="img-fluid"></p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>